<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartRoutes</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
  
  <style>
     /* Basic reset */
 * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    scroll-behavior: smooth;
  }

  /* Header Styling */
  header {
    display: flex;
    align-items: center;
    background-color: darkgoldenrod;
    padding: 10px 20px;
  }

  /* Logo Styling */
  .logo-container {
    margin-right: 20px;
  }

  .logo {
    
    height: auto;
    transition: transform 0.3s ease;
  }

  .logo:hover {
    transform: scale(1.1);
  }

  /* Navigation Bar Styling */
  .navbar {
    display: flex;
    list-style-type: none;
    flex-grow: 1;
    justify-content: center;
    background-color: chocolate;
  }

  .navbar li {
    position: relative;
    margin: 0 10px;
  }

  .navbar a {
    color: white;
    text-decoration: none;
    padding: 10px 15px;
    display: block;
  }

  /* Hover Effect */
  .navbar a:hover {
    background-color: #b5651d;
    border-radius: 5px;
  }

  /* Dropdown Styling */
  .dropdown-content {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background-color: #333;
    min-width: 150px;
    z-index: 1;
  }

  .dropdown-content a {
    color: white;
    padding: 10px;
    text-decoration: none;
    display: block;
  }

  .dropdown-content a:hover {
    background-color: #555;
    cursor: pointer;
  }

  /* Show Dropdown */
  .dropdown:hover .dropdown-content {
    display: block;
  }
   /* Welcome Section */
   .welcome-section {
    background-color: #f2f2f2;
    padding: 30px;
    text-align: center;
  }

  .welcome-section h2 {
    font-size: 2em;
    margin-bottom: 10px;
  }

  .welcome-section p {
    font-size: 1.2em;
    color: #666;
  }

  /* Key Features Section */
  .features {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    padding: 20px;
    background-color: #e6e6e6;
    gap: 20px;
  }

  .feature {
    flex: 1 1 calc(33.33% - 20px);
    width: 30%;
    text-align: center;
    overflow: hidden;
    padding: 10px;
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    cursor: pointer;
  }
  .feature:hover {
    transform: scale(1.05); /* Slight zoom on hover */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* More prominent shadow */
    background-color: #f3f3f3; /* Lighten the background */
  }

  .feature img {
    width: 100%; 
    height: auto; 
    border-radius: 6px;
  }
  .feature:hover img {
    filter: brightness(1.2); /* Brighten image on hover */
  }
  .feature:hover h3 {
    color: #007BFF; /* Change text color on hover */
  }
  .feature h3 {
    color: darkgoldenrod;
    font-size: 1.5em;
    margin-bottom: 10px;
  }

  .feature p {
    color: #555;
  }
  @media (max-width: 480px) {
    .feature {
      flex: 1 1 100%; /* Full-width on very small screens */
    }
  }
  @media (max-width: 768px) {
    .feature {
      flex: 1 1 calc(50% - 20px); /* Adjust for smaller screens */
    }
  }
  /* Map Section */
  .map-section {
    padding: 30px;
    text-align: center;
  }

  .map-section h2 {
    font-size: 2em;
    color: darkgoldenrod;
    margin-bottom: 20px;
  }

  .map-container {
    background-color: #e6e6e6;
    height: 300px;
    border: 2px solid darkgoldenrod;
    border-radius: 10px;
  }

  /* Call to Action */
  .cta-button {
    display: inline-block;
    margin: 30px auto;
    padding: 15px 30px;
    background-color: chocolate;
    color: white;
    font-size: 1.2em;
    text-align: center;
    border-radius: 5px;
    text-decoration: none;
    transition: background-color 0.3s;
  }

  .cta-button:hover {
    background-color: darkgoldenrod;
  }
   /* About Us Section Styling */
   .about-section {
    display: none; /* Hidden by default */
    padding: 20px;
    background-color: #f9f9f9;
    text-align: left;
  }

  .about-section h2 {
    color: darkgoldenrod;
  }
  .about-us h1 {
    color: #004c99;
    text-align: center;
  }
  
  .about-us h2 {
    color: #0066cc;
    margin-top: 20px;
  }
  
  .about-us p, .about-us ul {
    margin-bottom: 15px;
  }
  
  .about-us ul {
    list-style: disc;
    margin-left: 20px;
  }
  
  /* Footer */
  footer {
  background-color: chocolate;
  color: white;
  padding: 20px;
  text-align: center;
}

.footer-container {
  display: flex;
  justify-content: space-around; /* Space sections evenly */
  flex-wrap: wrap; /* Ensure it wraps on smaller screens */
  text-align: left;
}

.footer-section {
  flex: 1; /* Equal width for all sections */
  margin: 10px;
  min-width: 150px; /* Ensures sections don't get too small */
}

.footer-section h4 {
  margin-bottom: 10px;
  color: #ffd700;
  text-transform: uppercase;
}

.column-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.column-list li {
  margin-bottom: 5px;
}

.column-list li a {
  color: white;
  text-decoration: none;
}

.column-list li a:hover {
  color: #ffd700;
  text-decoration: underline;
}
.social-icons {
    display: flex;              /* Use flexbox */
    flex-direction: column;     /* Arrange items in a column */
    align-items: center;        /* Center the icons horizontally */
    gap: 10px;                  /* Add spacing between icons */
    margin: 0;
    padding: 0;
  }
.social-icons a {
  margin: 0 5px; /* Space between icons */
  display: inline-block; /* Ensure icons are inline */
}

.social-icons img {
  width: 30px; /* Consistent size for all icons */
  height: 30px;
  border-radius: 50%; /* Circular icons */
  transition: transform 0.3s ease;
}

.social-icons img:hover {
  transform: scale(1.2); /* Enlarge icons on hover */
}
.footer-copyright {
  text-align: center;
  scroll-margin-bottom: 20px; /* Move the copyright further down */
  font-size: 14px;
}
footer p {
  margin-top: 20px;
  font-size: 14px;
}

  /* Mission and Vision Cards */
.container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin: 20px auto;
  justify-content: left;
  max-width: 100%;
}

.card {
  background: #f9f9f9;
  border: 1px solid #ddd;
  border-radius: 8px;
  width: 100%;
  max-width: 350px;
  overflow: hidden;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease;
}

.card:hover {
  transform: scale(1.05);
}

.card-image {
  width: 100%;
  height: 200px;
  object-fit: cover;
}

.card-content {
  padding: 15px;
}

.card-content h2 {
  font-size: 20px;
  color: #004c99;
  margin-bottom: 10px;
}

.card-content p {
  font-size: 14px;
  color: #555;
}
@media (max-width: 768px) {
  .card {
    width: 100%; /* Full-width on smaller screens */
  }
}
.why-choose-us {
  list-style: disc; 
  margin-left: 20px; 
  padding-left: 10px; 
}
/*service*/
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  justify-content: center;
  align-items: center;
}

.modal-content {
  background-color: white;
  padding: 20px;
  border-radius: 5px;
  text-align: center;
}

.close {
  float: right;
  font-size: 20px;
  cursor: pointer;
}
.modal-content p {
  margin-top: 10px;
  font-size: 14px;
}

.modal-content a {
  color: blue;
  text-decoration: underline;
  cursor: pointer;
}
.modal-content {
  display: flex;
  flex-direction: column;
  gap: 1em;
  background-color: #fff;
  padding: 2em;
  border-radius: 5px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

button {
  padding: 10px 15px;
  border: none;
  border-radius: 5px;
  background-color: #28a745;
  color: white;
  cursor: pointer;
}

button:hover {
  background-color: #218838;
}

    #map {margin-bottom: 5px; width: 100%; height: 400px; display: none; }
    #contact {
  padding: 5px;
 background-color: burlywood;
  text-align: center;
}

#contact h2 {
  color: #004c99;
  margin-bottom: 20px;
}

#contactForm {
  margin: 0 auto;
  max-width: 500px;
  text-align: left;
}

#contactForm input, #contactForm textarea {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

#contactForm button {
  width: 100%;
  padding: 10px;
  background-color: #004c99;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

#contactForm button:hover {
  background-color: #0066cc;
}

#contactDetails {
  margin-top: 30px;
  text-align: center;
}

#contactDetails p {
  font-size: 1.1em;
  margin: 5px 0;
}
.footer-nav {
    list-style: none;
    padding: 0;
  }

  .footer-nav li {
    margin-bottom: 5px;
  }

  .footer-nav li a {
    color: white;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .footer-nav li a:hover {
    color: #ffd700;
    text-decoration: underline;
  }

  footer {
    background-color: chocolate;
    color: white;
    padding: 20px;
    text-align: center;
  }
  
  </style>
</head>
<body>
  <header id="navigationBar">
    <div class="logo-container">
      <img id="logoImage" src="https://cdn.vectorstock.com/i/preview-1x/30/05/car-sharing-ride-route-concept-colored-icon-vector-46373005.jpg" alt="Smart Rides" width="50">
    </div>
    <ul class="navbar">
      <li><a href="#home" id="home">Home</a></li>
      <li><a href="#about" onclick="toggleAbout()">About Us</a></li>
      <li class="dropdown">
        <a href="#services" class="dropbtn">Services</a>
        <div class="dropdown-content" id="services-menu">
          <a href="#" onclick="selectService('fuel')">Fuel Stations</a>
      <a href="#" onclick="selectService('electric')">EV Charging Stations</a>
        
        </div>
      </li>
            <li><a href="#contact" onclick="toggleContact()">Contact-Us</a></li>

    </ul>
  </header>
  <header>
    <h1>Welcome to Smart Rides</h1>
  </header>

  <div id="login-section" style="display:none;">
    <form id="loginForm">
      <input type="email" name="email" placeholder="Email" required />
      <input type="password" name="password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>
    <p>New user? <a href="#" onclick="switchToRegister()">Register here</a></p>
  </div>

  <div id="register-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('register-modal')">&times;</span>
      <h2>Driver Registration</h2>
      <form action="/driver/register" method="POST">
        <input type="text" name="first_name" placeholder="First Name" required />
        <input type="text" name="last_name" placeholder="Last Name" required />
        <input type="email" name="email" placeholder="Email" required />
        <input type="text" name="phone" placeholder="Phone" required />
        <input type="text" name="license_number" placeholder="License Number" required />
        <input type="text" name="vehicle_type" placeholder="Vehicle Type" />
        <input type="text" name="vehicle_registration" placeholder="Vehicle Registration" />
        <input type="password" name="password" placeholder="Password" required />
        <button type="submit">Register</button>
      </form>
      <p>Already have an account? <a href="#" onclick="switchToLogin()">Login here</a></p>
    </div>
  </div>
   <!-- Welcome Section -->
   <section class="welcome-section"  id="welcomeSection">
    <h2>Your Guide to Fueling and Charging Stations in Kenya</h2>
    <p>Discover the best fueling and electric vehicle charging stations across Kenya. Plan your trips with ease, and stay powered on the go.</p>
  </section>

  <!-- Key Features Section -->
  <section class="features" id="homeSection">
    <div class="feature">
      <h3>Fueling Stations Finder</h3>
      <p>Locate fueling stations across Kenya and never run out of fuel on your journey. Get real-time updates on availability and location.</p>
    <img src="https://images.pexels.com/photos/28861585/pexels-photo-28861585/free-photo-of-wide-angle-shot-of-a-modern-gas-station-at-dusk.jpeg?auto=compress&cs=tinysrgb&w=400" alt="Fuel Station">
    </div>
    <div class="feature">
      <h3>Electric Charging Stations</h3>
      <p>Find electric vehicle charging stations nearby and plan your trips without range anxiety. Perfect for eco-conscious drivers.</p>
      <img src="https://images.pexels.com/photos/4678065/pexels-photo-4678065.jpeg?auto=compress&cs=tinysrgb&w=600" alt="Electric charging station">
    </div>
    <div class="feature">
      <h3>Route Planning</h3>
      <p>Get customized routes with stops at fueling or charging stations, optimized for the best travel experience.</p>
    
    <img src="https://images.pexels.com/photos/6169870/pexels-photo-6169870.jpeg?auto=compress&cs=tinysrgb&w=400" alt="route planning"></div>
  </section>
 
  

 <!-- About Us Section -->
 <section class="about-section" id="aboutSection">
  <h2>About Smart Rides</h2>
  <p>Smart Rides provides reliable information on fueling and electric charging stations across Kenya to help you plan your trips effectively. Whether you're driving a traditional vehicle or an electric one, we have you covered!</p>
  <div class="container">
    <!-- Mission -->
    <div class="card">
      <img src="https://images.pexels.com/photos/7985589/pexels-photo-7985589.jpeg?auto=compress&cs=tinysrgb&w=600&lazy=load" alt="Mission Image" class="card-image">
      <div class="card-content">
        <h2>Our Mission</h2>
        <p>To provide drivers with a seamless navigation experience, integrating technology with convenience and sustainability.</p>
      </div>
    </div>

    <!-- Vision -->
    <div class="card">
      <img src="https://images.pexels.com/photos/244822/pexels-photo-244822.jpeg?auto=compress&cs=tinysrgb&w=600&lazy=load" alt="Vision Image" class="card-image">
      <div class="card-content">
        <h2>Our Vision</h2>
        <p>We aspire to become the go-to platform for drivers across the globe, ensuring every journey is efficient, safe, and eco-friendly.</p>
      </div>
    </div>
  </div>
  <h2>Why Choose Smartrides?</h2>
  <ul class="why-choose-us">
    <li>Reliable and accurate station data</li>
    <li>User-friendly interface</li>
    <li>Commitment to sustainable travel solutions</li>
    <li>Partnerships with fuel and EV station providers</li>
  </ul>

  <h2>Join Us</h2>
  <p>Join thousands of drivers who trust Smartrides to make every journey smoother and more efficient. <a href="#services" id="exploreServicesLink">Explore our services now!</a></p>
</section>
<!-- Call to Action -->
<div style="text-align: center;">
  <h3 style="color: rgb(188, 109, 5);">Explore the Charging Stations across kenya</h3>

  <div id="map-different" style="height: 500px; margin-bottom: 10px; width: 100%;"></div>
</div>

<section id="contact"  style="display: none;">
  <h2>Contact Us</h2>
  <div id="contactDetails">
    <h3>Our Contact Details:</h3>
    <p><strong>Address:</strong> 11027 SmartRides Street, Nairobi, Kenya</p>
    <p><strong>Phone:</strong> +254 741509510</p>
    <p><strong>Email:</strong> incsmartride@gmail.com</p>
  </div>

</section>


  <div id="map-section" style="display: none;">
    <button onclick="manuallyEnterLocation()">Manually Enter Location</button>
    <button id="fetchNearbyStationsButton">Fetch Nearby Stations</button>
    <select id="stationType">
      <option value="fuel">Fuel Stations</option>
      <option value="electric">EV Stations</option>
    </select>
    <button id="loadStationsButton">Load Stations</button>
    <input type="text" id="locationName" placeholder="Enter location name (e.g., Nairobi)" />
<button onclick="loadStationsByLocation()">Find Stations</button>
<button id="startDirectionButton">Start Direction</button>
<div>
  <h3>Select a Station</h3>
  <select id="stationsDropdown">
    <option value="" disabled selected>Select a station</option>
  </select>
  <button id="startDirections">Start Directions</button>
</div>

    <div id="map"></div>
    <div id="results"></div> 
  </div>
  <footer>
    <div class="footer-container">
      <!-- Quick Links -->
      <div class="footer-section">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="/terms-and-conditions">Terms & Conditions</a></li>
          <li><a href="/privacy-policy">Privacy Policy</a></li>
          <li><a href="/faq">FAQ</a></li>
        </ul>
      </div>
  
      <!-- Latest News -->
      <div class="footer-section">
        <h4>Latest News</h4>
        <ul>
          <li><a href="/news/new-ev-stations">New EV Stations in Nairobi</a></li>
          <li><a href="/news/discounted-rates">Discounted Fuel Rates for Users</a></li>
        </ul>
      </div>
  
    
  <!-- Social Media Icons -->
  <div class="footer-section">
    <h4>Follow Us</h4>
    <div class="social-icons">
      <a href="https://twitter.com/smartridekenya" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733579.png" alt="Twitter Icon" width="24">
      </a>
      <a href="https://instagram.com/smartridekenya" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733558.png" alt="Instagram Icon" width="24">
      </a>
      <a href="https://facebook.com/smartridekenya" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733547.png" alt="Facebook Icon" width="24">
      </a>
    </div>
  </div>
  <!-- Footer Navigation Links -->
  <div class="footer-section">
    <h4>Quick Links</h4>
    <ul class="footer-nav">
      <li><a href="#homeSection">Home</a></li>
      <li><a href="#aboutSection">About</a></li>
      <li><a href="#contact">Contact Us</a></li>
      <li><a href="#login-section">Services</a></li>
    </ul>
  </div>
 
    <!-- Copyright -->
    <p  class="footer-copyright" style="text-align: justify;">&copy; 2024 Smartrides. All rights reserved.</p>
  
  </footer>
  
  
  <script>
    let markerLayer;
    let userLat, userLon;

    document.addEventListener("DOMContentLoaded", () => {
  const logoImage = document.getElementById("logoImage");
  if (logoImage) {
    logoImage.addEventListener("click", function () {
      alert("Welcome to Smart Rides!");
    });
  } else {
    console.error("Element with id 'logoImage' not found.");
  }
});

  //about us section
  function toggleAbout() {
    const aboutSection = document.getElementById('aboutSection');
    // Toggle the visibility of the "About Us" section
    if (aboutSection.style.display === 'none' || aboutSection.style.display === '') {
      aboutSection.style.display = 'block';
      aboutSection.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Smooth scroll
    } else {
      aboutSection.style.display = 'none';
    }
  }
  // Attach the toggleAbout function to all "About Us" links
  document.querySelectorAll('a[href="#aboutSection"]').forEach(link => {
    link.addEventListener('click', function (e) {
      e.preventDefault(); // Prevent default anchor behavior
      toggleAbout();
    });
  });
//services
function toggleLoginRegister(service) {
    localStorage.setItem("selectedService", service);
    document.getElementById("login-section").style.display = "block";
  }

  function closeModal(modalId) {
    document.getElementById(modalId).style.display = "none";
  }

  document.querySelector("a[href='#about']").addEventListener("click", (event) => {
  event.preventDefault(); // Prevent default link behavior
  document.getElementById("aboutSection").scrollIntoView({ behavior: "smooth" });
});

function selectService(serviceType) {
  // Save the selected service type to local storage
  localStorage.setItem("selectedService", serviceType);
  alert(`You selected ${serviceType} stations. Please log in to view.`);
}
async function fetchStations(serviceType) {
    console.log("Fetching stations for service:", serviceType);
    try {
        const response = await fetch(`/stations?serviceType=${serviceType}`);
        const data = await response.json();
        console.log("Stations data:", data);
        // Render stations on the map or UI
    } catch (error) {
        console.error("Error fetching stations:", error);
        alert("Unable to fetch stations. Please try again.");
    }
}


  document.querySelectorAll("#services-menu a").forEach(link => {
    link.addEventListener("click", () => {
      toggleLoginRegister(link.textContent.trim());
    });
  });

  document.addEventListener("DOMContentLoaded", () => {
  const homeLink = document.getElementById("footerHomeLink");
  homeLink.addEventListener("click", (e) => {
    e.preventDefault(); // Prevent default jump behavior
    window.scrollTo({
      top: 0,
      behavior: "smooth", // Smooth scrolling
    });
  });
});



  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();

      const targetId = this.getAttribute('href').substring(1); // Remove "#" to get the ID
      const targetElement = document.getElementById(targetId);

      if (targetElement) {
        // Make the section visible if it was hidden
        if (targetElement.style.display === 'none') {
          targetElement.style.display = 'block';
        }

        // Smooth scroll to the section
        targetElement.scrollIntoView({
          behavior: 'smooth',
          block: 'start',
        });
      }
    });
  });


  document.addEventListener("DOMContentLoaded", () => {
  const registrationForm = document.querySelector("#register-modal form");

  if (registrationForm) {
    registrationForm.addEventListener("submit", async (event) => {
      event.preventDefault();

      const formData = new FormData(registrationForm);
      const formObject = Object.fromEntries(formData.entries());

      try {
        const response = await fetch("/driver/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formObject),
        });

        let result;
        try {
          // Try parsing JSON response
          result = await response.json();
        } catch (error) {
          console.error("Non-JSON response received:", await response.text());
          throw new Error("Unexpected response format from the server.");
        }

        if (response.ok && result.success) {
          alert(result.message);
          document.getElementById("register-modal").style.display = "none";
        } else {
          console.error("Server error:", result);
          alert(`Error: ${result.message || "Unexpected error occurred."}`);
        }
      } catch (error) {
        console.error("Unexpected client-side error:", error);
        alert("Unexpected error occurred. Please try again.");
      }
    });
  }
});






  function switchToRegister() {
    console.log("Switching to register modal...");
    document.getElementById("login-section").style.display = "none";
    document.getElementById("register-modal").style.display = "block";
  }
  
  function switchToLogin() {
    console.log("Switching to login modal...");
    document.getElementById("register-modal").style.display = "none";
    document.getElementById("login-section").style.display = "block";
  }
  
  function closeModal(modalId) {
    console.log(`Closing ${modalId} modal...`);
    document.getElementById(modalId).style.display = "none";
  }
document.getElementById('loginForm').addEventListener('submit', async (event) => {
  event.preventDefault();
  const formData = new FormData(event.target);

  try {
    const response = await fetch('/driver/login', {
      method: 'POST',
      body: formData,
    });

    const result = await response.json();
    if (result.success) {
      alert('Login successful!');
       // Retrieve the selected service from local storage
       const selectedService = localStorage.getItem("selectedService") || "fuel";

// Fetch and display the corresponding stations
fetchStations(selectedService);
   // Show the stations section
      document.getElementById("stations-section").style.display = "block";
      document.getElementById('login-section').style.display = 'none';
      document.getElementById('map-section').style.display = 'block';
      document.getElementById("homeSection").style.display = "none";
       document.getElementById("aboutSection").style.display = "none";

     // Show only the "Services" section
     document.getElementById("services").style.display = "block";
     document.getElementById("services").scrollIntoView({ behavior: "smooth" });
     initMap();
       // Get the driver's live location
       navigator.geolocation.getCurrentPosition(
        position => {
          const { latitude, longitude } = position.coords;
          fetchNearbyStations(latitude, longitude);
        },
        error => {
          console.error('Geolocation error:', error);
          alert('Unable to fetch your location. Please manually enter it.');
        }
      );
    } else {
      alert(result.message);
    }
  } catch (error) {
    console.error('Login error:', error);
  }
});

function initMap() {
  map = L.map('map').setView([-1.286389, 36.817223], 13); // Nairobi center
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors',
  }).addTo(map);

  markerLayer = L.layerGroup().addTo(map);
}


document.addEventListener("DOMContentLoaded", function () {
  // Reference to the "Explore our services" link
  const exploreServicesLink = document.getElementById("exploreServicesLink");

  // Add click event listener
  exploreServicesLink.addEventListener("click", function (event) {
    event.preventDefault(); // Prevent default anchor link behavior

    // Trigger the login functionality (reusing the logic from navigation bar)
    document.getElementById("login-section").style.display = "block"; // Show login form
    document.getElementById("aboutSection").style.display = "none"; // Hide "About Us" section if visible
    document.getElementById("contact").style.display = "none"; 
    document.getElementById("homeSection").style.display = "none"; // Hide "home" section if visible
    document.getElementById("map-different").style.display = "none"; // Hide " map-different" section if visible
    document.getElementById("welcomeSection").style.display = "none"; // Hide " welcome-section" section if visible

    
    // Scroll smoothly to the login section
    document.getElementById("login-section").scrollIntoView({ behavior: "smooth" });
  });
});



  // Ensure the DOM has loaded
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('loadStationsButton').addEventListener('click', () => {
      if (!map) {
        initMap(); // Ensure the map is initialized
      }
      loadStations();
    });
  });
async function loadStations() {
  if (!navigator.geolocation) {
    alert('Geolocation is not supported by your browser.');
    return;
  }
  
  const stationType = document.getElementById('stationType').value;
  console.log('Station type selected:', stationType);

  // Get the driver's live location
   navigator.geolocation.getCurrentPosition(
    async (position) => {
      const { latitude, longitude } = position.coords;
      const radius = 50; // Fixed radius of 50 km

  try {
    const response = await fetch(`/driver/nearby-stations?latitude=${latitude}&longitude=${longitude}&station_type=${stationType}&radius=${radius}`, {
     
      credentials: 'include', // Ensure cookies are sent
    });
    const data = await response.json();

    if (data.success  && markerLayer) {
      renderMarkersOnMap(data.stations);
      markerLayer.clearLayers();
      data.stations.forEach(station => {
        L.marker([station.latitude, station.longitude])
          .addTo(markerLayer)
          .bindPopup(`<strong>${station.name}</strong><br>Location: ${station.location}`);
      });
    } else {
      alert(data.message || 'No stations found.');
    }
  } catch (error) {
    console.error('Error fetching stations:', error);
  }
},
(error) => {
      console.error('Geolocation error:', error);
      alert('Unable to fetch your location. Please ensure location services are enabled.');
    }
  );
}
    

    document.getElementById('loginForm').addEventListener('submit', async (event) => {
  event.preventDefault();

  const formData = new FormData(event.target);
  const formObject = Object.fromEntries(formData.entries()); // Convert FormData to a plain object

  try {
    const response = await fetch('/driver/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json', // Set Content-Type header
      },
      body: JSON.stringify(formObject), // Send JSON stringified body
    });
// Try to parse JSON response
let result;
        try {
            result = await response.json();
          } catch (e) {
            console.error("Response is not valid JSON:", await response.text());
            alert("Unexpected server response. Please try again later.");
            return;
        }
    if (response.ok) {
      alert('Login successful!');


       // Validate selectedService
       const selectedService = localStorage.getItem("selectedService");
       console.log("Selected Service:", localStorage.getItem("selectedService"));

       if (!selectedService) {
                alert("No service selected. Defaulting to Fuel Stations.");
                localStorage.setItem("selectedService", "fuel"); // Default to fuel
            }
            
            // Fetch stations for the selected service
            fetchStations(localStorage.getItem("selectedService"));
       // Hide navigation bar and welcome sections
      document.getElementById('navigationBar').style.display = 'none';
      document.querySelector('.welcome-section').style.display = 'none';
      document.querySelector('.features').style.display = 'none';
      document.getElementById('login-section').style.display = 'none';
      document.getElementById('map-section').style.display = 'block';
      document.getElementById('aboutSection').style.display = 'none';
      document.getElementById('contact').style.display = 'none';
      document.getElementById('map-different').style.display = 'none';
      initMap();
    } else {
      alert('Login failed. Please check your credentials.');
    }
  } catch (error) {
    console.error('Error logging in:', error);
  }
});
function toggleContact() {
  const contactSection = document.getElementById('contact');
  contactSection.style.display = contactSection.style.display === 'block' ? 'none' : 'block';
}
let map, userMarker, routingControl;

function initMap() {
  const mapElement = document.getElementById("map");
  mapElement.style.display = "block"; // Ensure map is visible

  // Initialize the map
  map = L.map("map").setView([0, 0], 13);

  // Add OpenStreetMap tiles
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "&copy; OpenStreetMap contributors",
  }).addTo(map);

  // Initialize a layer group for markers
  markerLayer = L.layerGroup().addTo(map);

  // Fetch and display the user's live location
  navigator.geolocation.getCurrentPosition(
    (position) => {
      const { latitude, longitude } = position.coords;
      console.log("Live location obtained:", latitude, longitude);
      map.setView([latitude, longitude], 15); // Center map on live location
      pinUserLocation(latitude, longitude); // Add red marker for live location
      fetchNearbyStations(latitude, longitude); // Fetch and display nearby stations
    },
    (error) => {
      console.error("Geolocation error:", error);
      alert("Unable to fetch your live location. Defaulting to Nairobi.");
   
    }
  );
}

function pinUserLocation(latitude, longitude) {
  const redIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/684/684908.png", // Red marker icon
    iconSize: [30, 30],
    iconAnchor: [15, 30],
    popupAnchor: [0, -30],
  });

  if (userMarker) {
    userMarker.setLatLng([latitude, longitude]).bindPopup("Your Live Location").openPopup();
  } else {
    userMarker = L.marker([latitude, longitude], { icon: redIcon })
      .addTo(map)
      .bindPopup("Your Live Location")
      .openPopup();
  }
}


async function fetchNearbyStations(latitude, longitude,serviceType) {
  const stationType = document.getElementById('stationType').value; // Dropdown value
    console.log('Fetching stations for:', latitude, longitude, stationType);
  try {
    const selectedService = localStorage.getItem('selectedService');
    const stationType = document.getElementById('stationType').value;
    const radius = 50; // Fixed radius of 50 km
    const response = await fetch(`/driver/nearby-stations?latitude=${latitude}&longitude=${longitude}&station_type=${stationType}&radius=${radius}`, {
      
      credentials: 'include', // Include session cookies
    });
    console.log(`Request URL: /driver/nearby-stations?latitude=${latitude}&longitude=${longitude}&station_type=${stationType}&radius=${radius}`);
   
     const data = await response.json();

    if (data.success) {
      console.log('Stations fetched:', data.stations);
      renderMarkersOnMap(data.stations);
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = ''; // Clear previous results

      if (data.stations.length > 0) {
        const table = document.createElement('table');
        table.border = 1;

        // Add table headers
        const headers = ['Station Name', 'Location', 'Services', 'Fuel Types', 'Contact', 'Opening Hours', 'Rating'];
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        headers.forEach(header => {
          const th = document.createElement('th');
          th.textContent = header;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        // Add station data
        const tbody = document.createElement('tbody');
        data.stations.forEach(station => {
          const row = document.createElement('tr');

          const stationFields = [
            station.station_name,
            station.location,
            station.services,
            station.fuel_types,
            station.contact_number,
            station.opening_hours,
            station.rating || 'N/A'
          ];

          stationFields.forEach(field => {
            const td = document.createElement('td');
            td.textContent = field;
            row.appendChild(td);
          });

          tbody.appendChild(row);
        });
        table.appendChild(tbody);

        resultsDiv.appendChild(table);
      } else {
        resultsDiv.textContent = 'No nearby stations found.';
      }
      /*// Clear existing markers
      if (markerLayer) markerLayer.clearLayers();
      data.stations.forEach((station) => {
        L.marker([station.latitude, station.longitude])
          .addTo(map)
          .bindPopup(`
            <strong>${station.station_name}</strong><br>
            Location: ${station.location}<br>
            Services: ${station.services}<br>
            Fuel Types: ${station.fuel_types}<br>
            Contact: ${station.contact_number}<br>
            Opening Hours: ${station.opening_hours}<br>
            Rating: ${station.rating || 'N/A'}
          `);
      });*/
    } else {
      alert('Error fetching stations: ' + data.message);
    }
  } catch (error) {
    console.error('Error fetching nearby stations:', error);
  }
}

function manuallyEnterLocation() {
  const latitude = parseFloat(prompt('Enter Latitude:'));
  const longitude = parseFloat(prompt('Enter Longitude:'));

  if (isNaN(latitude) || isNaN(longitude)) {
    alert('Invalid location input.');
    return;
  }

  // Initialize the map if it doesn't exist
  if (!map) {
    initMap();
  }

  // Check if userMarker exists; if not, create it
  if (userMarker) {
    userMarker.setLatLng([latitude, longitude]).bindPopup('Your Location').openPopup();
  } else {
    userMarker = L.marker([latitude, longitude])
      .addTo(map)
      .bindPopup('Your Location')
      .openPopup();
  }

  // Update map view
  map.setView([latitude, longitude], 13);

  // Fetch nearby stations
  fetchNearbyStations(latitude, longitude);
}

document.getElementById('fetchNearbyStationsButton').addEventListener('click', () => {
  if (!map) {
    initMap(); // Ensure the map is initialized
  }
  

  navigator.geolocation.getCurrentPosition(
    position => {
      const { latitude, longitude } = position.coords;
      fetchNearbyStations(latitude, longitude);

    // Pin user's location on the map
    pinUserLocation(latitude, longitude);

    // Destination example (replace with actual station coordinates from your data)
    const destination = { lat: -1.28333, lng: 36.81667 }; // Example coordinates

    // Add routing control
    L.Routing.control({
      waypoints: [
        L.latLng(latitude, longitude), // User's live location
        L.latLng(destination.lat, destination.lng) // Next station
      ],
      routeWhileDragging: true,
      showAlternatives: true,
      createMarker: (i, waypoint, n) => {
        return L.marker(waypoint.latLng, {
          title: i === 0 ? "Start (Your Location)" : i === n - 1 ? "Destination" : `Waypoint ${i}`
        });
      },
      lineOptions: {
        styles: [{ color: 'blue', opacity: 0.6, weight: 4 }]
      }
    }).addTo(map);
  
    },
    error => {
      console.error('Geolocation error:', error);
      alert('Unable to fetch your location. Please manually enter it.');
    }
  );
});
function renderMarkersOnMap(stations) {
  if (markerLayer) markerLayer.clearLayers(); // Clear existing markers

  if (stations.length === 0) {
    alert('No stations found for the selected type.');
    return;
  }

  stations.forEach((station) => {
    L.marker([station.latitude, station.longitude])
      .addTo(markerLayer)
      .bindPopup(`<strong>${station.name}</strong><br>Location: ${station.location}`);
  });
}

async function loadStationsByLocation() {
  const locationName = document.getElementById('locationName').value.trim();

  if (!locationName) {
    alert('Please enter a location name.');
    return;
  }

  try {
    // Call Nominatim API to get latitude and longitude for the location name
    const geocodeResponse = await fetch(
      `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(locationName)}&format=json&limit=1`
    );

    const geocodeData = await geocodeResponse.json();

    if (geocodeData.length > 0) {
      const { lat, lon } = geocodeData[0];

      console.log(`Resolved location: ${locationName} => Latitude: ${lat}, Longitude: ${lon}`);

      // Fetch stations near the resolved latitude and longitude
      fetchNearbyStations(lat, lon);
    } else {
      alert('Unable to resolve location name. Please try again with a more specific address.');
    }
  } catch (error) {
    console.error('Error during geocoding:', error);
    alert('An error occurred while resolving the location name. Please try again.');
  }
}
document.addEventListener("DOMContentLoaded", function () {
  // Initialize the map
  const map = L.map("map-different").setView([-1.2921, 36.8219], 7); // Center at Nairobi, Kenya

  // Add OpenStreetMap tile layer
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 18,
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
  }).addTo(map);

  // Create different icon styles for fuel and EV stations
  const fuelIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/685/685655.png", // Fuel icon URL
    iconSize: [40, 40],
    iconAnchor: [20, 40],
    popupAnchor: [0, -40],
  });

  const evIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/2897/2897558.png", // EV icon URL
    iconSize: [40, 40],
    iconAnchor: [20, 40],
    popupAnchor: [0, -40],
  });

  // Initialize marker clustering
  const markerClusterGroup = L.markerClusterGroup();
  map.addLayer(markerClusterGroup);

  // Fetch station data dynamically from Overpass API
  function fetchStations() {
  const query = `
    [out:json][timeout:25];
    relation["name"="Kenya"];
    map_to_area->.kenya;
    node["amenity"="fuel"](area.kenya);
    out body;
  `;

  const url = `https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`;

  fetch(url)
    .then((response) => {
      if (!response.ok) {
        throw new Error("Failed to fetch fuel station data");
      }
      return response.json();
    })
    .then((data) => {
      const fuelIcon = L.icon({
        iconUrl: "https://cdn-icons-png.flaticon.com/512/685/685655.png", // Replace with fuel icon URL
        iconSize: [30, 30],
        iconAnchor: [15, 30],
        popupAnchor: [0, -30],
      });

      // Create a marker cluster group
      const markerClusterGroup = L.markerClusterGroup();

      data.elements.forEach((element) => {
        if (element.lat && element.lon) {
          const name = element.tags.name || "Unnamed Fuel Station";

          const marker = L.marker([element.lat, element.lon], { icon: fuelIcon })
            .bindPopup(`<strong>${name}</strong><br>Fuel Station`);

          // Add marker to the cluster group
          markerClusterGroup.addLayer(marker);
        }
      });

      // Add cluster group to the map
      map.addLayer(markerClusterGroup);
    })
    .catch((error) => {
      console.error("Error fetching fuel station data:", error);
    });
}

  // Highlight major highways
  function fetchHighways() {
    const query = `
  [out:json][timeout:25];
  way["highway"~"motorway|trunk"](area:3600361685);
  (._;>;);
  
  out body;
`;


    const url = `https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`;

    fetch(url)
      .then((response) => {
        if (!response.ok) {
          throw new Error("Failed to fetch highway data");
        }
        return response.json();
      })
      .then((data) => {
        data.elements.forEach((element) => {
          if (element.type === "way" && element.geometry) {
            const latlngs = element.geometry.map((node) => [node.lat, node.lon]);
            L.polyline(latlngs, {
              color: "blue",
              weight: 4,
              opacity: 0.7,
            }).addTo(map);
          }
        });
      })
      .catch((error) => {
        console.error("Error fetching highway data:", error);
      });
  }

  // Call fetch functions
  fetchStations();
  fetchHighways();

  // Adjust view dynamically
  map.on("moveend", function () {
    console.log("Map bounds:", map.getBounds());
  });
});
function pinUserLocation(latitude, longitude) {
  // Create a red marker for the user's live location
  const redIcon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/684/684908.png", // Replace with a red marker icon URL if needed
    iconSize: [30, 30],
    iconAnchor: [15, 30],
    popupAnchor: [0, -30],
  });

  // If the marker already exists, update its position
  if (userMarker) {
    userMarker.setLatLng([latitude, longitude]).bindPopup("Your Live Location").openPopup();
  } else {
    userMarker = L.marker([latitude, longitude], { icon: redIcon })
      .addTo(map)
      .bindPopup("Your Live Location")
      .openPopup();
  }

  // Center the map on the user's live location
  map.setView([latitude, longitude], 15);
}
document.getElementById("startDirectionButton").addEventListener("click", async () => {
  // Ensure the live location is available
  if (!userMarker) {
    alert("Live location not available. Please enable location services.");
    return;
  }

  const { lat, lng } = userMarker.getLatLng();

  try {
    const stationType = document.getElementById("stationType").value;
    const response = await fetch(
      `/driver/nearby-stations?latitude=${lat}&longitude=${lng}&station_type=${stationType}&radius=50`
    );
    const data = await response.json();

    if (data.success && data.stations.length > 0) {
      const nearestStation = data.stations[0];
      startRouting(lat, lng, nearestStation.latitude, nearestStation.longitude);
    } else {
      alert("No stations found nearby.");
    }
  } catch (error) {
    console.error("Error fetching stations:", error);
  }
});

function startRouting(userLat, userLng, stationLat, stationLng) {
  if (routingControl) {
    map.removeControl(routingControl); // Clear any existing route
  }

  routingControl = L.Routing.control({
    waypoints: [L.latLng(userLat, userLng), L.latLng(stationLat, stationLng)],
    routeWhileDragging: true,
  }).addTo(map);
}

// Define coordinates for fuel and EV charging stations
const stations = [
  { id: 1, name: "Fuel Station A", type: "fuel", latitude: -1.286389, longitude: 36.817223 },
  { id: 2, name: "Fuel Station B", type: "fuel", latitude: -1.2921, longitude: 36.8219 },
  { id: 3, name: "EV Charging Station A", type: "electric", latitude: -1.295, longitude: 36.804 },
];

// Function to populate stations in a dropdown
function populateStationsDropdown() {
  const dropdown = document.getElementById("stationsDropdown");
  stations.forEach((station) => {
    const option = document.createElement("option");
    option.value = `${station.latitude},${station.longitude}`;
    option.textContent = `${station.name} (${station.type})`;
    dropdown.appendChild(option);
  });
}

// Initialize the dropdown
document.addEventListener("DOMContentLoaded", populateStationsDropdown);

// Handle "Start Directions" button
document.getElementById("startDirections").addEventListener("click", () => {
  const selectedStation = document.getElementById("stationsDropdown").value;
  if (!selectedStation) {
    alert("Please select a station to start directions.");
    return;
  }

  // Extract user's live location
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (position) => {
        const userLatitude = position.coords.latitude;
        const userLongitude = position.coords.longitude;

        // Launch Google Maps with the user's location as the starting point
        const [destinationLatitude, destinationLongitude] = selectedStation.split(",");
        const googleMapsURL = `https://www.google.com/maps/dir/${userLatitude},${userLongitude}/${destinationLatitude},${destinationLongitude}`;
        window.open(googleMapsURL, "_blank");
      },
      (error) => {
        alert("Error fetching your location. Please enable location services.");
        console.error("Geolocation error:", error);
      }
    );
  } else {
    alert("Geolocation is not supported by your browser.");
  }
});


  </script>
</body>
</html>
